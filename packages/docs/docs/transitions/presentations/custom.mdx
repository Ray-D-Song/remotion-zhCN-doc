---
image: /generated/articles-docs-transitions-presentations-custom.png
crumb: '@remotion/transitions'
title: '自定义演示'
---

本页面描述如何为 [`<TransitionSeries>`](/docs/transitions/transitionseries) 创建自定义效果。

## 概念

演示是一个高阶组件，包裹进入幻灯片和退出幻灯片，并基于三个参数实现效果：

<Step>1</Step> 当前的 <code>presentationProgress</code>，受过渡时间的影响
<br />
<Step>2</Step> <code>presentationDirection</code>，可以是 <code>entering</code> 或 <code>exiting</code>
<br />
<Step>3</Step> <code>presentationDurationInFrames</code>（从 v4.0.153 版本开始可用）
<Step>4</Step> 开发者定义的额外 <code>passedProps</code>

## 样板

自定义演示是一个返回 `TransitionPresentation` 类型对象的函数。  
它是一个包含 React 组件（`component`）和作为 `passedProps` 传递给组件的 React props 的对象。

```tsx twoslash title="custom-presentation.tsx"
import type {TransitionPresentationComponentProps} from '@remotion/transitions';

const StarPresentation: React.FC<
  TransitionPresentationComponentProps<CustomPresentationProps>
> = ({children, presentationDirection, presentationProgress, passedProps}) =>
  null;

// ---cut---

import type {TransitionPresentation} from '@remotion/transitions';

type CustomPresentationProps = {
  width: number;
  height: number;
};

export const customPresentation = (
  props: CustomPresentationProps,
): TransitionPresentation<CustomPresentationProps> => {
  return {component: StarPresentation, props};
};
```

`component` 是一个接收以下 props 的 React 组件：

<Step>1</Step> <code>children</code>: 要包裹的标记
<br />
<Step>2</Step> <code>presentationDirection</code>: 可以是 <code>
  "entering"
</code> 或 <code>"exiting"</code>
<br />
<Step>3</Step> <code>presentationProgress</code>: 介于 <code>
  0
</code> 和 <code>1</code> 之间的数字，表示过渡的进度。
<br />
<Step>4</Step> <code>passedProps</code>: 传递给演示的自定义 props

<br />
<br />

```tsx twoslash title="StarPresentation.tsx"
type CustomPresentationProps = {
  width: number;
  height: number;
};

// ---cut---
import type {TransitionPresentationComponentProps} from '@remotion/transitions';
import {AbsoluteFill} from 'remotion';

const StarPresentation: React.FC<
  TransitionPresentationComponentProps<CustomPresentationProps>
> = ({children, presentationDirection, presentationProgress, passedProps}) => {
  return (
    <AbsoluteFill>
      <AbsoluteFill>{children}</AbsoluteFill>
    </AbsoluteFill>
  );
};
```

## 示例

<Demo type="custom-presentation" />

以下示例实现了星形遮罩过渡：

<Step>1</Step> 基于 <code>passedProps</code> <code>height</code> 和 <code>width</code>，计算星星的内半径，以完全填充画布。
<br />
<Step>2</Step> 使用 <a href="/docs/shapes"><code>@remotion/shapes</code></a>，计算 SVG 路径，并从零增长到画布的全尺寸。 <br />
<Step>3</Step> 使用 <code>presentationProgress</code> 插值形状大小。 <br /> <Step>4</Step> 使用 <a href="/docs/paths"><code>@remotion/paths</code></a> 将星星居中在画布中央。
<br />
<Step>5</Step> 使用 <code>clipPath</code> 剪切进入幻灯片。
在容器内，渲染 <code>children</code>。
<br />
<Step>6</Step> 如果 <code>presentationDirection</code> 设置为 <code>"exiting"</code>，则禁用效果。


<br />
<br />

```tsx twoslash title="StarPresentation.tsx"
import {getBoundingBox, translatePath} from '@remotion/paths';
import {makeStar} from '@remotion/shapes';
import type {TransitionPresentationComponentProps} from '@remotion/transitions';
import React, {useMemo, useState} from 'react';
import {AbsoluteFill, random} from 'remotion';

export type CustomPresentationProps = {
  width: number;
  height: number;
};

const StarPresentation: React.FC<
  TransitionPresentationComponentProps<CustomPresentationProps>
> = ({children, presentationDirection, presentationProgress, passedProps}) => {
  const finishedRadius =
    Math.sqrt(passedProps.width ** 2 + passedProps.height ** 2) / 2;
  const innerRadius = finishedRadius * presentationProgress;
  const outerRadius = finishedRadius * 2 * presentationProgress;

  const {path} = makeStar({
    innerRadius,
    outerRadius,
    points: 5,
  });

  const boundingBox = getBoundingBox(path);

  const translatedPath = translatePath(
    path,
    passedProps.width / 2 - boundingBox.width / 2,
    passedProps.height / 2 - boundingBox.height / 2,
  );

  const [clipId] = useState(() => String(random(null)));

  const style: React.CSSProperties = useMemo(() => {
    return {
      width: '100%',
      height: '100%',
      clipPath:
        presentationDirection === 'exiting' ? undefined : `url(#${clipId})`,
    };
  }, [clipId, presentationDirection]);

  return (
    <AbsoluteFill>
      <AbsoluteFill style={style}>{children}</AbsoluteFill>
      {presentationDirection === 'exiting' ? null : (
        <AbsoluteFill>
          <svg>
            <defs>
              <clipPath id={clipId}>
                <path d={translatedPath} fill="black" />
              </clipPath>
            </defs>
          </svg>
        </AbsoluteFill>
      )}
    </AbsoluteFill>
  );
};
```

示例用法：

```tsx twoslash title="MyComp.tsx"
import {springTiming, TransitionSeries} from '@remotion/transitions';
import {AbsoluteFill, useVideoConfig} from 'remotion';

import type {
  TransitionPresentation,
  TransitionPresentationComponentProps,
} from '@remotion/transitions';

type CustomPresentationProps = {
  width: number;
  height: number;
};

export const customPresentation = (
  props: CustomPresentationProps,
): TransitionPresentation<CustomPresentationProps> => {
  return {component: StarPresentation, props};
};

const StarPresentation: React.FC<
  TransitionPresentationComponentProps<CustomPresentationProps>
> = ({children, presentationDirection, presentationProgress, passedProps}) =>
  null;

export const Letter: React.FC<{
  children: React.ReactNode;
  color: string;
}> = ({children, color}) => {
  return <AbsoluteFill style={{}}>{children}</AbsoluteFill>;
};

// ---cut---
export const MyComp: React.FC = () => {
  const {width, height} = useVideoConfig();

  return (
    <TransitionSeries>
      <TransitionSeries.Sequence durationInFrames={70}>
        <Letter color="orange">A</Letter>
      </TransitionSeries.Sequence>
      <TransitionSeries.Transition
        presentation={customPresentation({width, height})}
        timing={springTiming({
          durationInFrames: 45,
          config: {
            damping: 200,
          },
          durationRestThreshold: 0.0001,
        })}
      />
      <TransitionSeries.Sequence durationInFrames={60}>
        <Letter color="pink">B</Letter>
      </TransitionSeries.Sequence>
    </TransitionSeries>
  );
};
```

## 参考

查看[已实现的演示文稿](https://github.com/remotion-dev/remotion/blob/main/packages/transitions/src/presentations)的源代码，以获取有用的参考。

## 另请参阅

- [自定义时间](/docs/transitions/timings/custom)

