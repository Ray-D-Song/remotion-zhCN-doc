---
image: /generated/articles-docs-renderer-render-media.png
id: render-media
title: renderMedia()
crumb: '@remotion/renderer'
---

_自 v3.0 起可用 - `@remotion/renderer` 包的一部分。_

以编程方式渲染视频或音频。

```tsx twoslash title="render.mjs"
// @module: esnext
// @target: es2017
const serveUrl = '/path/to/bundle';
const outputLocation = '/path/to/frames';

import {renderMedia, selectComposition} from '@remotion/renderer';

const inputProps = {
  titleText: 'Hello World',
};

const composition = await selectComposition({
  serveUrl,
  id: 'my-video',
  inputProps,
});

// ---cut---

await renderMedia({
  composition,
  serveUrl,
  codec: 'h264',
  outputLocation,
  inputProps,
});
```

查看一个[`示例`](/docs/ssr-node)，展示 `renderMedia()` 与 [`bundle()`](/docs/bundle) 和 [`selectComposition()`](/docs/renderer/select-composition) 在[服务器端渲染页面](/docs/ssr-node)上的用法。

## 参数

一个具有以下属性的对象：

### `serveUrl`

_string_

可以是指向由 [`bundle()`](/docs/bundle) 生成的 Remotion Webpack bundle 的本地路径，也可以是存储该 bundle 的 URL。

### `port?`

优先使用特定端口来提供 Remotion 项目。如果未指定，将使用随机端口。

### `outputLocation?`

_string - 自 v3.0.26 起可选_

输出工件的保存位置。可以是绝对路径或相对路径，相对于当前工作目录解析。必须是文件路径（而不是文件夹）。

如果未指定或设置为 `null`，文件将以内存中的缓冲区形式返回。

### `composition`

_VideoConfig_

描述使用 `id`、`width`、`height`、`fps`、`durationInFrames`、`defaultProps` 和 `props` 的合成的对象。  
调用 [`selectComposition()`](/docs/renderer/select-composition) 或 [`getCompositions()`](/docs/renderer/get-compositions) 来获取可能配置的数组。

### `codec`

_"h264" | "h265" | "vp8" | "vp9" | "mp3" | "aac" | "wav" | "prores" | "h264-mkv" | "gif"_

为输出媒体选择适当的编解码器。请参考[编码指南](/docs/encoding)以找到最适合您用例的编解码器。

### `inputProps?`

_object - 可选_

[传递给视频的选定合成的输入属性。](/docs/passing-props#passing-input-props-in-the-cli)  
必须是 JSON 对象。  
从根组件中，可以使用 [`getInputProps()`](/docs/get-input-props) 读取属性。  
您可以使用 [`calculateMetadata()`](/docs/calculate-metadata) 转换输入属性。

确保将相同的 `inputProps` 传递给 [`selectComposition()`](/docs/renderer/select-composition) 以使其正常工作。

### `frameRange?`

_number | [number, number] - optional_

指定要渲染的单个帧（传递一个 `number`）或一系列帧（传递一个元组 `[number, number]`）。通过传递 `null`（默认值），将渲染合成的所有帧。

### `concurrency?`

_optional_

指定应同时启动多少个渲染进程的 `number`，指定要使用的 CPU 线程百分比的 `string`，或者传递 `null` 以让 Remotion 根据主机机器的 CPU 自行决定。默认值是可用 CPU 线程数量的一半。

### `logLevel?`<AvailableFrom v="4.0.0"/>

<Options id="log" />

### `onArtifact?`<AvailableFrom v="4.0.176" />

处理由 [`<Artifact>`](/docs/artifact) 组件发出的[工件](/docs/artifacts#using-rendermedia-renderstill-or-renderframes)。

### `audioCodec?`

_"pcm-16" | "aac" | "mp3" | "opus"，从 v3.3.41 开始提供_

选择音频的编码方式。

- 默认值取决于所选的 `codec`。
- 如果需要未压缩音频，请选择 `pcm-16`。
- 并非所有视频容器都支持所有音频编解码器。
- 如果 `codec` 选项还指定了音频编解码器，则此选项优先。

请参阅[编码指南](/docs/encoding/#audio-codec)以查看默认值和支持的组合。

### `audioBitrate?`<AvailableFrom v="3.2.32" />

<Options id="audio-bitrate" />

### `videoBitrate?`<AvailableFrom v="3.2.32" />

<Options id="video-bitrate" />

### `crf?`

_number | null - optional_

常数速率因子，控制质量。参见：[使用 CRF 设置控制质量。](/docs/encoding/#controlling-quality-using-the-crf-setting)

### `bufferSize?`<AvailableFrom v="4.0.78" />

<Options id="buffer-size" />

### `maxRate?`<AvailableFrom v="4.0.78" />

<Options id="max-rate" />

### `imageFormat?`

_"jpeg"（默认） | "png" | "none" - 从 v3.2.27 开始可选_

帧应以哪种图像格式呈现。

- `jpeg` 是默认值，速度最快
- `png` 如果您想要[渲染透明视频](/docs/transparent-videos/)
- `none` 如果您正在渲染音频



### `browserExecutable?`<AvailableFrom v="3.0.11" />

_可选_

一个字符串，定义应该使用的浏览器可执行文件在磁盘上的绝对路径。默认情况下，Remotion 将尝试自动检测并下载一个，如果没有可用的。如果定义了 `puppeteerInstance`，它将优先于 `browserExecutable`。

### `everyNthFrame?`<AvailableFrom v="3.1.0" />

_可选_

仅渲染每第 n 帧。例如，仅每第二帧，每第三帧等。仅适用于渲染 GIF。[点击此处了解更多详情。](/docs/render-as-gif)

### `numberOfGifLoops?`<AvailableFrom v="3.1.0" />

_可选_

<Options id="number-of-gif-loops" />

### `pixelFormat?`

_字符串 - 可选_

[要使用的自定义像素格式。](/docs/transparent-videos/) 通常用于特殊用例，如透明视频。

### `envVariables?`

`Record<string, string> - 可选`

一个包含要注入到项目中的环境变量的对象。

查看：[环境变量](/docs/env-variables/)

### `jpegQuality?`

_数字 - 可选_

设置生成的 JPEG 图像的质量。必须是介于 0 和 100 之间的整数。默认是由浏览器决定，[当前默认值为 80](https://github.com/chromium/chromium/blob/99314be8152e688bafbbf9a615536bdbb289ea87/headless/lib/browser/protocol/headless_handler.cc#L32)。

仅在 `imageFormat` 为 `'jpeg'` 时适用，否则此选项无效。

### `muted?`<AvailableFrom v="3.2.1" />

_布尔值 - 可选_

如果设置为 true，则不会渲染任何音频。

### `enforceAudioTrack?`<AvailableFrom v="3.2.1" />

_布尔值 - 可选_

如果没有其他音频轨道，则渲染一个静音音轨。

### `puppeteerInstance?`

_puppeteer.Browser - 可选_

一个已打开的 Puppeteer [`Browser`](/docs/renderer/open-browser) 实例。使用 [`openBrowser()`](/docs/renderer/open-browser) 创建一个新实例。在多个函数调用之间重用浏览器可以加快渲染过程。您负责自行打开和关闭浏览器。如果不指定此选项，将在最后打开并关闭一个新浏览器。

### `scale?`

_可选_

通过因子缩放输出尺寸。查看[Scaling](/docs/scaling)以了解更多关于此功能的信息。

### `overwrite?`

_布尔值 - 可选_

如果设置为false，则如果文件已经存在，则不会写入输出文件。

### `onStart?`

_函数_ - 可选

一旦渲染器准备好开始渲染并计算要渲染的帧数，将调用回调函数：

```tsx twoslash
import {OnStartData} from '@remotion/renderer';

const onStart = ({
  frameCount,
  parallelEncoding, // available from v4.0.52
  resolvedConcurrency, // available from v4.0.180
}: OnStartData) => {
  console.log(`Beginning to render ${frameCount}.`);

  if (parallelEncoding) {
    console.log('Parallel encoding is enabled.');
  }

  console.log(`Using concurrency: ${resolvedConcurrency}`);
};
```

### `onProgress?`

_函数 - 可选_

响应渲染进度。以下回调函数类似于 Remotion 在其 CLI 上显示渲染进度的方式：

```tsx twoslash title="简单示例 - 记录整体进度"
import {RenderMediaOnProgress} from '@remotion/renderer';

const onProgress: RenderMediaOnProgress = ({progress}) => {
  console.log(`Rendering is ${progress * 100}% complete`);
};
```

```tsx twoslash title="高级示例 - 细粒度进度值"
import {RenderMediaOnProgress} from '@remotion/renderer';

const onProgress: RenderMediaOnProgress = ({
  renderedFrames,
  encodedFrames,
  encodedDoneIn,
  renderedDoneIn,
  stitchStage,
}) => {
  if (stitchStage === 'encoding') {
    // First pass, parallel rendering of frames and encoding into video
    console.log('Encoding...');
  } else if (stitchStage === 'muxing') {
    // Second pass, adding audio to the video
    console.log('Muxing audio...');
  }
  // Amount of frames rendered into images
  console.log(`${renderedFrames} rendered`);
  // Amount of frame encoded into a video
  console.log(`${encodedFrames} encoded`);
  // Time to create images of all frames
  if (renderedDoneIn !== null) {
    console.log(`Rendered in ${renderedDoneIn}ms`);
  }
  // Time to encode video from images
  if (encodedDoneIn !== null) {
    console.log(`Encoded in ${encodedDoneIn}ms`);
  }
};
```

:::note
`progress` 属性从 v3.2.17 版本开始可用。
:::

### `onDownload?`

_函数 - 可选_

如果您的项目中包含音频（或带有声音的视频），Remotion 需要下载它才能在输出文件中使用其音频。您可以使用此回调来响应下载的发生和进展。

```tsx twoslash
import {RenderMediaOnDownload} from '@remotion/renderer';

const onDownload: RenderMediaOnDownload = (src) => {
  console.log(`Downloading ${src}...`);
  return ({percent, downloaded, totalSize}) => {
    // percent and totalSize can be `null` if the downloaded resource
    // does not have a `Content-Length` header
    if (percent === null) {
      console.log(`${downloaded} bytes downloaded`);
    } else {
      console.log(`${Math.round(percent * 100)}% done)`);
    }
  };
};
```

### `proResProfile?`

_字符串 - 可选_

设置 ProRes 配置文件。仅适用于使用 `prores` 编解码器渲染的视频。请参阅[编码指南](/docs/encoding/#controlling-quality-using-prores-profile)以获取可能的选项。

### `x264Preset?`

_字符串 - 可选_

<Options id="x264-preset" />

### `onBrowserLog?`

_函数 - 可选_

捕获打印的控制台消息。示例：

```tsx twoslash
import {BrowserLog} from '@remotion/renderer';

const onBrowserLog = (log: BrowserLog) => {
  // `type` is the console.* method: `log`, `warn`, `error`, etc.
  console.log(`[${log.type}]`);
  console.log(log.text);
  console.log(`at ${log.stackTrace}`);
};
```

### `timeoutInMilliseconds?`

_可选_

描述渲染可能需要多长时间来解决所有 [`delayRender()`](/docs/delay-render) 调用[在超时之前](/docs/timeout)。默认值：`30000`

### `cancelSignal?`<AvailableFrom v="3.0.15" />

_可选_

允许取消渲染的令牌。参见：[`makeCancelSignal()`](/docs/renderer/make-cancel-signal)

### `chromiumOptions?`<AvailableFrom v="2.6.5" />

_可选_

允许您设置某些 Chromium / Google Chrome 标志。请参阅：[Chromium 标志](/docs/chromium-flags)。

:::note
需要在浏览器启动时设置 Chromium 标志。如果您通过 [`puppeteerInstance`](#puppeteerinstance) 传递了一个实例，则传递给 `renderMedia()` 的选项将不适用，而是传递给 [`openBrowser()`](/docs/renderer/open-browser) 的标志。
:::

#### `disableWebSecurity?`

_boolean - 默认 `false`_

这将主要禁用 CORS 和其他安全功能。

#### `enableMultiProcessOnLinux?`<AvailableFrom v="4.0.42" />

_boolean - 默认 `true`_

<Options id="enable-multiprocess-on-linux" />

#### `ignoreCertificateErrors?`

_boolean - 默认 `false`_

导致无效的 SSL 证书（如自签名证书）被忽略。

#### `headless?`

<Options id="disable-headless" />

#### `gl?`

<Options id="gl" />

#### `userAgent?`<AvailableFrom v="3.3.83"/>

允许您设置 headless Chrome 浏览器所使用的自定义用户代理。

### `ffmpegOverride?`<AvailableFrom v="3.2.22" />

_function - 可选_

修改 Remotion 在底层使用的 FFMPEG 命令。它以 reducer 风格工作，这意味着您传递一个接受命令作为参数并返回新命令的函数。

```tsx twoslash
import type {FfmpegOverrideFn} from '@remotion/renderer';

const ffmpegOverride: FfmpegOverrideFn = ({type, args}) => {
  console.log(type); // "stitcher" | "pre-stitcher
  return [...args, '-vf', 'eq=brightness=0:saturation=1'];
};
```

您传递的函数必须接受一个对象作为唯一参数，该对象包含以下属性：

- `type`：为 `"stitcher"` 或 `"pre-stitcher"`。如果有足够的内存和 CPU 可用，Remotion 可能会使用并行渲染和编码，这意味着在渲染所有帧之前会生成一个 pre-stitcher 进程。您可以通过在渲染命令中添加 `--log=verbose` 来判断是否启用了并行编码。
- `args`：作为 FFMPEG 命令参数传递的字符串数组。

您的函数必须返回一个修改后的字符串数组。

:::warning
不建议使用此功能。在使用之前，我们希望让您了解一些注意事项：

- 渲染命令可能会随着任何新的 Remotion 版本更改，即使是补丁升级也可能会破坏您对此功能的使用。
- 根据所选的编解码器、可用的 CPU 和 RAM，Remotion 可能会或可能不会使用 "并行编码"，这将导致执行多个 FFMPEG 命令。您的函数必须能够处理多次调用。
- 当使用 Remotion Lambda 时，此功能不可用。

在您使用此技巧之前，请在[Discord](https://remotion.dev/discord)上联系Remotion团队，询问我们是否愿意以一种干净的方式实现您需要的功能 - 我们经常根据用户的反馈快速实现新功能。

:::

### `disallowParallelEncoding`<AvailableFrom v="3.2.29" />

禁止渲染器同时进行渲染帧和编码。这使得渲染过程更节省内存，但可能会更慢。

### `offthreadVideoCacheSizeInBytes?`<AvailableFrom v="4.0.23"/>

<Options id="offthreadvideo-cache-size-in-bytes" />

### `colorSpace?`<AvailableFrom v="4.0.28"/>

<Options id="color-space" />

### `repro?`<AvailableFrom v="4.0.88" />

_boolean - 默认为 `false`_

<Options id="repro" />

### `binariesDirectory?`<AvailableFrom v="4.0.120" />

<Options id="binaries-directory" />

### `separateAudioTo?`<AvailableFrom v="4.0.123" />

<Options cli id="separate-audio-to" />

### `forSeamlessAacConcatenation?`<AvailableFrom v="4.0.123" />

<Options id="for-seamless-aac-concatenation" />

### `onBrowserDownload?`<AvailableFrom v="4.0.137" />

<Options id="on-browser-download" />

### ~~`parallelism?`~~

在v3.2.17中更名为 `concurrency`。
在`v4.0.0`中移除。

### ~~`quality?`~~

在`v4.0.0`中更名为 `jpegQuality`。

### ~~`dumpBrowserLogs?`~~

_可选 - 默认为 `false`，在v4.0中已弃用_

已弃用，建议使用 [`logLevel`](#loglevel)。

### ~~`verbose?`~~

_可选，已在v4.0中弃用_

已弃用，建议使用 [`logLevel`](#loglevel)。

### ~~`onSlowestFrames?`~~

在v3.2.29中引入，从v4.0中移除。`slowestFrames` 已移至返回类型。

在 `renderMedia()` 解析之前调用的回调函数。  
唯一的参数 `slowestFrames` 是一个形如 `{frame:<帧编号>, time:<渲染帧所需时间 ms>}` 的包含10个最慢帧的数组。您可以使用此信息来优化您的渲染时间。

### ~~`ffmpegExecutable`~~

_在v4.0中移除，字符串，可选_

覆盖要使用的 `ffmpeg` 可执行文件的绝对路径。

### ~~`ffprobeExecutable?`~~ <AvailableFrom v="3.0.17" />

_在 v4.0 中移除，可选_

用于覆盖 `ffprobe` 可执行文件的绝对路径。

## 返回值

_**从 v4.0.0 开始:**_

返回值是一个具有以下属性的对象：

- `buffer`: 如果未指定 `outputLocation` 或为 `null`，则包含一个缓冲区，否则为 `null`。
- `slowestFrames`: 一个包含 10 个最慢帧的数组，格式为 `{frame:<帧编号>, time:<渲染帧所需时间 ms>}`。您可以使用此信息来优化渲染时间。

_**从 v3.0.26 开始:**_

如果未指定 `outputLocation` 或为 `null`，则返回值是一个解析为 `Buffer` 的 Promise。如果指定了输出位置，则返回值是一个解析为无值的 Promise。

## 参见

- [此函数的源代码](https://github.com/remotion-dev/remotion/blob/main/packages/renderer/src/render-media.ts)
- [服务器端渲染](/docs/ssr)
- [getCompositions()](/docs/renderer/get-compositions)
- [renderStill()](/docs/renderer/stitch-frames-to-video)
- [renderMediaOnLambda()](/docs/lambda/rendermediaonlambda)
