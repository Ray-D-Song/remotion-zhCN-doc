---
image: /generated/articles-docs-artifacts.png
title: 发出工件
id: artifacts
crumb: '技术'
---

# 发出工件<AvailableFrom v="4.0.176" />

有时候在渲染视频时，您希望生成额外的文件。例如：

- 一个 `.srt` 字幕文件
- 一个包含视频章节的 `.txt` 文件
- 一个用于视频中使用的资产的 `CREDITS` 文件
- 渲染中的调试信息

您可以使用 [`<Artifact>`](/docs/artifact) 组件来从您的视频中发出任意文件。

:::note
目前 `@remotion/cloudrun` 不支持发出工件。
:::

## 示例

```tsx twoslash title="MyComp.tsx"
// @filename: subtitles.tsx

export const generateSubtitles = () => {
  return ``;
};
// @filename: MyComp.tsx
// ---cut---
import React from 'react';
import {Artifact, useCurrentFrame} from 'remotion';
import {generateSubtitles} from './subtitles';

export const MyComp: React.FC = () => {
  const frame = useCurrentFrame();
  return (
    <>
      {frame === 0 ? (
        <Artifact filename="captions.srt" content={generateSubtitles()} />
      ) : null}
    </>
  );
};
```

## 工件规则

<Step>1</Step> 资产应该仅在视频的一个单独帧中渲染。
否则，该资产将被发出多次。<br />

<Step>2</Step> 可以发出多个资产，但它们可能不具有相同的文件名。<br/>

<Step>3</Step> 对于 <code>content</code> 属性，可以传递一个 <code>string</code>，或者一个 <code>Uint8Array</code> 用于二进制数据。传递一个 <code>
  Uint8Array
</code> 不应被认为更快，因为它必须被序列化。
<br />

## 接收工件

### 在 CLI 或 Studio 中

在渲染视频时，工件将保存到 `out/[composition-id]/[filename]`。

### 使用 `renderMedia()`、`renderStill()` 或 `renderFrames()`

使用 [`onArtifact`](/docs/renderer/render-media#onartifact) 回调来接收工件。

```tsx twoslash title="render.mjs"
// @module: es2022
// @target: es2017
import type {VideoConfig} from 'remotion';

const composition: VideoConfig = {
  width: 100,
  height: 100,
  fps: 30,
  defaultProps: {},
  props: {},
  defaultCodec: null,
  id: 'hi',
  durationInFrames: 100,
};
const serveUrl = 'http://localhost:8080';
const inputProps = {};
import fs from 'fs';
// ---cut---
import {renderMedia, OnArtifact} from '@remotion/renderer';

const onArtifact: OnArtifact = (artifact) => {
  console.log(artifact.filename); // string
  console.log(artifact.content); // string | Uint8Array
  console.log(artifact.frame); // number, frame in the composition which emitted this

  // Example action: Write the artifact to disk
  fs.writeFileSync(artifact.filename, artifact.content);
};

await renderMedia({
  composition,
  serveUrl,
  onArtifact,
  codec: 'h264',
  inputProps,
});
```

### 使用 Remotion Lambda CLI

当使用 [`npx remotion lambda render`](/docs/lambda/cli/render) 或 [`npx remotion lambda still`](/docs/lambda/cli/still) 时，工件将保存到 S3 存储桶中的键 `renders/[render-id]/artifacts/[filename]`。

它们将被记录到控制台，并且您可以单击它们来下载。  
`--privacy` 选项也适用于工件。

### 使用 `renderMediaOnLambda()`

当使用 [`renderMediaOnLambda()`](/docs/lambda/rendermediaonlambda) 时，工件将保存到 S3 存储桶中的键 `renders/[render-id]/artifacts/[filename]`。

您可以从[`getRenderProgress()`](/docs/lambda/getrenderprogress#artifacts)获取当前接收到的资产列表。

```tsx twoslash title="progress.ts"
// @module: es2022
// @target: es2017
import {getRenderProgress} from '@remotion/lambda/client';

const renderProgress = await getRenderProgress({
  renderId: 'hi',
  functionName: 'hi',
  bucketName: 'hi',
  region: 'eu-central-1',
});

for (const artifact of renderProgress.artifacts) {
  console.log(artifact.filename); // "hello-world.txt"
  console.log(artifact.sizeInBytes); // 12
  console.log(artifact.s3Url); // "https://s3.eu-central-1.amazonaws.com/remotion-lambda-abcdef/renders/abcdef/artifacts/hello-world.txt"
  console.log(artifact.s3Key); // "renders/abcdef/artifacts/hello-world.txt"
}
```

### 使用 `renderStillOnLambda()`

当使用[`renderStillOnLambda()`](/docs/lambda/renderstillonlambda)时，资产将保存到 S3 存储桶中的键为 `renders/[render-id]/artifacts/[filename]`。

您可以从`renderStillOnLambda()`的`artifacts`字段中获取已接收资产的列表。

```tsx twoslash title="still.ts"
const serveUrl = 'http://localhost:8080';
const inputProps = {};
const functionName = 'hi';
const composition = 'hi';
const privacy = 'public' as const;
const imageFormat = 'png' as const;
const region = 'eu-central-1' as const;

// ---cut---
// @module: es2022
// @target: es2017
import {renderStillOnLambda} from '@remotion/lambda/client';

const stillResponse = await renderStillOnLambda({
  functionName,
  region,
  serveUrl,
  composition,
  inputProps,
  imageFormat,
  privacy,
});

for (const artifact of stillResponse.artifacts) {
  console.log(artifact.filename); // "hello-world.txt"
  console.log(artifact.sizeInBytes); // 12
  console.log(artifact.s3Url); // "https://s3.eu-central-1.amazonaws.com/remotion-lambda-abcdef/renders/abcdef/artifacts/hello-world.txt"
  console.log(artifact.s3Key); // "renders/abcdef/artifacts/hello-world.txt"
}
```

### 使用 Cloud Run

在 Cloud Run Alpha 中，不支持发出资产并将引发错误。  
我们计划在未来修改 Cloud Run 以使用与 Lambda 相同的运行时，并将带来此功能。

## 另请参阅

- [`<Artifact>`](/docs/artifact)
```
