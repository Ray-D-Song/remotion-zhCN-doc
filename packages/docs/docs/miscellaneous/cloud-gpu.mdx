---
image: /generated/articles-docs-miscellaneous-cloud-gpu.png
sidebar_label: 云中的 GPU（裸机）
title: 在云中使用 GPU
crumb: "常见问题"
---

## 启动 EC2 实例

<Step>1</Step> <strong>确保您被允许使用 GPU</strong>

您可能需要向 AWS 请求增加您可以使用的 GPU 数量的限制。  
您可以在 AWS 控制台中执行此操作。  
转到 "服务配额" -> "AWS 服务" -> "Amazon Elastic Compute Cloud (Amazon EC2)" -> "Running On-Demand G and VT instances" -> "Request increase at account-level"。  
您也可以点击[此处](https://us-east-1.console.aws.amazon.com/servicequotas/home/services/ec2/quotas/L-DB2E81BA)直接访问 `us-east-1` 区域的页面。

<Step>2</Step> <strong>启动 EC2 实例</strong>

[点击此处在 `us-east-1` 上启动 EC2 实例](https://us-east-1.console.aws.amazon.com/ec2/home?region=us-east-1#LaunchInstances:)。  
选择 "浏览更多 AMI"，搜索 `ami-053b0d53c279acc90`，选择 "Community AMIs" 选项卡，并选择具有正确 AMI 的映像（"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-20230516"）。  
我们建议选择 `g4dn.xlarge` 大小 - 请注意，此实例的默认配置每月费用为 $375。  
如果您收到 "Subscribing to AMI is taking longer than expected" 消息，这是正常的。您可能需要等待几分钟。

<Step>3</Step> <strong>配置实例：</strong>

连接到实例后，运行以下命令：

```bash title="将 Linux 内核升级至 v6"
sudo bash -c "apt update && export DEBIAN_FRONTEND=noninteractive && export NEEDRESTART_MODE=a && apt upgrade -y && reboot"
```

实例将重新启动，因此会断开连接。等待片刻，然后重新连接。

```bash title="安装 libvulkan"
sudo apt install -y build-essential libvulkan1
```

```bash title="安装 GPU 驱动程序"
DRIVER_URL="https://us.download.nvidia.com/tesla/535.104.12/NVIDIA-Linux-x86_64-535.104.12.run"
DRIVER_NAME="NVIDIA-Linux-driver.run"
wget -O "$DRIVER_NAME" "$DRIVER_URL"
sudo sh "$DRIVER_NAME" --disable-nouveau --silent
rm "$DRIVER_NAME"
```

```bash title="配置启动服务"
echo '[Unit]
Description=Run nvidia-smi at system startup

[Service]
ExecStart=/usr/bin/nvidia-smi
Type=oneshot
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target' | sudo tee /etc/systemd/system/nvidia-smi.service
sudo systemctl enable nvidia-smi.service
sudo systemctl start nvidia-smi.service
```

```bash title="安装 Chrome"
curl -fsSL https://dl.google.com/linux/linux_signing_key.pub | sudo gpg --dearmor -o /usr/share/keyrings/googlechrom-keyring.gpg
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/googlechrom-keyring.gpg] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
sudo apt update
sudo apt install -y google-chrome-stable curl gnupg ca-certificates
```

```bash title="安装 Node.js"
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg

NODE_MAJOR=20
echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_$NODE_MAJOR.x nodistro main" | sudo tee /etc/apt/sources.list.d/nodesource.list

sudo apt-get update
sudo apt-get install nodejs -y
```

<Step>4</Step> <strong>使用 GPU 渲染视频</strong><br/>

```bash title="克隆 Remotion GPU 演示"
git clone https://github.com/remotion-dev/gpu-scene
cd gpu-scene
npm i
npx remotion render --browser-executable=/usr/bin/google-chrome-stable --gl=angle-egl --enable-multiprocess-on-linux
```

## 查看也

- [在 Docker 容器中运行此操作](/docs/miscellaneous/cloud-gpu-docker)
- [如何在 AWS 上的 Chrome、Chromium 和 Puppeteer 中启用硬件加速的无头模式](https://mirzabilal.com/how-to-enable-hardware-acceleration-on-chrome-chromium-puppeteer-on-aws-in-headless-mode)，本文档基于此。

<Credits contributors={[
{
username: "bilalmughal",
contribution: "研究和撰写"
},
{
username: "UmungoBungo",
contribution: "研究"
},
]} />
```
