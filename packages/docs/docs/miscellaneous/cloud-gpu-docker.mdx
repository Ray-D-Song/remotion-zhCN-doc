---
image: /generated/articles-docs-miscellaneous-cloud-gpu-docker.png
title: 在 EC2 上设置带 GPU 的 Docker
sidebar_label: 云中的 GPU（Docker）
crumb: "常见问题"
---

遵循以下步骤，以在 EC2 上的 Docker 容器中渲染视频。
这些步骤是有主观看法的，但指定了一个有效的参考。

警告：偏离说明，比如：

- 选择不同的 AMI
- 选择不同的 Docker 基础
- 选择 EC2 之外的其他内容
- 选择不同的主机

可能导致 GPU 不起作用。在这种情况下，很难进行调试。
我们建议首先按照这些说明操作，并在建立起可工作的设置后再进行更改。

## 在 EC2 上设置带 GPU 的 Docker

<Step>1</Step> 按照<a href="/docs/miscellaneous/cloud-gpu">EC2 上的 GPU</a>说明操作。
您可以跳过安装 Chrome、Node.js 和克隆存储库以渲染视频。
<br />

<Step>2</Step> 安装 NVIDIA 容器工具包：
<br />
<br />

```bash title="添加密钥环"
curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg
curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
sudo apt-get update
```

```bash title="安装工具包"
sudo apt-get install -y nvidia-container-toolkit
```

<Step>3</Step> 安装 Docker：<br />
<br />

```bash title="添加 Docker 的官方 GPG 密钥"
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

```bash title="添加密钥环"
echo "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
```

```bash title="安装 Docker"
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

<Step>4</Step>配置Docker以使用NVIDIA运行时 <br />
<br />

```bash title="配置NVIDIA容器运行时"
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker
```

<Step>5</Step> 创建两个文件，<code>Dockerfile</code> 和 <code>entrypoint.sh</code>
。例如，您可以使用 <code>nano ./file-to-create</code> 命令创建它们。
使用 <kbd>Ctrl</kbd>
<kbd>X</kbd> 保存并退出。 <br />
<br />

```bash title="Dockerfile"
FROM node:20-bookworm
RUN apt-get update
RUN apt-get install -y curl gnupg git chromium
RUN curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg
RUN echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_18.x nodistro main" > /etc/apt/sources.list.d/nodesource.list
RUN apt-get clean
RUN rm -rf /var/lib/apt/lists/*

# Clone the repo
RUN git clone https://github.com/remotion-dev/gpu-scene.git
WORKDIR /gpu-scene
RUN npm install

# Copy the entrypoint script into the image
COPY entrypoint.sh .

CMD ["sh", "./entrypoint.sh"]
```

```bash title="entrypoint.sh"
#!/bin/bash

npx remotion render --gl=angle-egl Scene out/video.mp4
```

<Step>6</Step> 构建容器并运行示例渲染: <br />
<br />

```bash
sudo docker build . -t remotion-docker-gpu
sudo docker run --gpus all --runtime=nvidia -e "NVIDIA_DRIVER_CAPABILITIES=all" remotion-docker-gpu
```

## 调试

使用[`npx remotion gpu`](/docs/cli/gpu) 命令获取 `chrome://gpu` 的输出，以验证 GPU 是否正常工作。

## 参见

- [EC2上的GPU](/docs/miscellaneous/cloud-gpu)
- [使用GPU](/docs/gpu)

<Credits
  contributors={[
    {
      username: "UmungoBungo",
      contribution: "工作流作者",
    },
    {
      username: "kaf-lamed-beyt",
      contribution: "撰写",
    },
  ]}
/>
