---
image: /generated/articles-docs-player-buffer-state.png
title: 'æ’­æ”¾å™¨ç¼“å†²çŠ¶æ€'
sidebar_label: ç¼“å†²çŠ¶æ€
id: buffer-state
crumb: æœ€ä½³å®è·µ
---

_ä»4.0.111ç‰ˆæœ¬å¼€å§‹å¯ç”¨_

å°±åƒå¸¸è§„è§†é¢‘æ’­æ”¾å™¨ä¸€æ ·ï¼Œæ’­æ”¾å™¨ä¸­æ˜¾ç¤ºçš„å†…å®¹å¯èƒ½å°šæœªå®Œå…¨åŠ è½½ã€‚  
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€ä½³å®è·µæ˜¯æš‚åœè§†é¢‘ï¼Œè®©å†…å®¹åŠ è½½å®Œæ¯•ï¼Œç„¶åæ¢å¤æ’­æ”¾ã€‚

Remotionå…·æœ‰æœ¬æœºç¼“å†²çŠ¶æ€ï¼Œå¯ä»¥åœ¨ç¼“å†²åŒºä¸ºç©ºæ—¶æš‚åœè§†é¢‘ã€‚

## ç®€è€Œè¨€ä¹‹

æ‚¨å¯ä»¥ä¸º[`<Video>`](/docs/video/#pausewhenbuffering)ã€[`<OffthreadVideo>`](/docs/offthreadvideo/#pausewhenbuffering)ã€[`<Audio>`](/docs/audio/#pausewhenbuffering)æ ‡ç­¾æ·»åŠ `pauseWhenBuffering`å±æ€§ã€‚  
å¯¹äº[`<Img>`](/docs/img/#pausewhenloading)æ ‡ç­¾ï¼Œè¯¥å±æ€§ç§°ä¸º`pauseWhenLoading`ã€‚  
é€šè¿‡è¿™æ ·åšï¼Œæ’­æ”¾å™¨å°†åœ¨åª’ä½“åŠ è½½å®Œæ¯•å‰æš‚åœä¸€å°æ®µæ—¶é—´ã€‚

## æœºåˆ¶

### æ¿€æ´»ç¼“å†²çŠ¶æ€

ç»„ä»¶å¯ä»¥é€šè¿‡é¦–å…ˆä½¿ç”¨[`useBufferState()`](/docs/use-buffer-state)é’©å­ï¼Œç„¶åè°ƒç”¨`buffer.delayPlayback()`æ¥å‘Šè¯‰æ’­æ”¾å™¨åˆ‡æ¢åˆ°ç¼“å†²çŠ¶æ€ï¼š

```tsx twoslash title="MyComp.tsx"
import React from 'react';
import {useBufferState} from 'remotion';

const MyComp: React.FC = () => {
  const buffer = useBufferState();

  React.useEffect(() => {
    const delayHandle = buffer.delayPlayback();

    setTimeout(() => {
      delayHandle.unblock();
    }, 5000);

    return () => {
      delayHandle.unblock();
    };
  }, []);

  return null;
};
```

è¦æ¸…é™¤å¥æŸ„ï¼Œè¯·åœ¨`delayPlayback()`çš„è¿”å›å€¼ä¸Šè°ƒç”¨`.unblock()`ã€‚

åœ¨æ¿€æ´»ç¼“å†²çŠ¶æ€æ—¶ï¼Œè¯·æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š

<details>
<summary>ç»„ä»¶å¸è½½æ—¶æ¸…é™¤å¥æŸ„</summary>

ç”¨æˆ·å¯èƒ½ä¼šå¯»æ‰¾è§†é¢‘çš„ä¸åŒéƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†å¯èƒ½ä¼šç«‹å³å¯ç”¨ã€‚  
ä½¿ç”¨<code>useEffect()</code>çš„æ¸…ç†å‡½æ•°åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤å¥æŸ„ã€‚

```tsx twoslash title="âŒ ä¸Reactä¸¥æ ¼æ¨¡å¼å†²çª"
import React, {useState} from 'react';
import {useBufferState} from 'remotion';

const MyComp: React.FC = () => {
  const buffer = useBufferState();
  const [delayHandle] = useState(() => buffer.delayPlayback()); // ğŸ’¥

  React.useEffect(() => {
    setTimeout(() => {
      delayHandle.unblock();
    }, 5000);
  }, []);

  return <></>;
};
```

</details>
<details>
<summary>ä¸è¦åœ¨<code>useState()</code>å†…éƒ¨ä½¿ç”¨<code>delayPlayback()</code></summary>

è™½ç„¶ä»¥ä¸‹å®ç°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æœ‰æ•ˆï¼Œä½†åœ¨Reactä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šå¤±è´¥ï¼Œå› ä¸º`useState()`é’©å­è¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œå¯¼è‡´ç¬¬ä¸€æ¬¡è°ƒç”¨çš„ç¼“å†²æ°¸è¿œä¸ä¼šè¢«æ¸…é™¤ã€‚

```tsx twoslash title="âŒ å½“å¯»æ‰¾è§†é¢‘çš„ä¸åŒéƒ¨åˆ†æ—¶ä¸æ¸…é™¤ç¼“å†²å¥æŸ„"
import React, {useState} from 'react';
import {useBufferState} from 'remotion';

const MyComp: React.FC = () => {
  const buffer = useBufferState();
  const [delayHandle] = useState(() => buffer.delayPlayback()); // ğŸ’¥

  React.useEffect(() => {
    setTimeout(() => {
      delayHandle.unblock();
    }, 5000);

    return () => {
      delayHandle.unblock();
    };
  }, []);

  return <></>;
};
```

</details>
<details>
<summary>å®ƒä¸ä¼šæ›¿æ¢<code>delayRender()</code></summary>
<a href="/docs/delay-render">delayRender()</a>æ˜¯ä¸€ä¸ªä¸åŒçš„APIï¼Œå®ƒæ§åˆ¶äº†åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä½•æ—¶æ‹æ‘„å±å¹•æˆªå›¾ã€‚<br/><br/>

å¦‚æœæ‚¨æ­£åœ¨åŠ è½½æ•°æ®ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å»¶è¿Ÿç»„ä»¶çš„æˆªå›¾ï¼Œå¹¶å»¶è¿Ÿé¢„è§ˆè§†é¢‘çš„æ’­æ”¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªAPIã€‚

```tsx twoslash title="åŒæ—¶ä½¿ç”¨delayRender()å’ŒdelayPlayback()"
import React from 'react';
import {useBufferState, delayRender, continueRender} from 'remotion';

const MyComp: React.FC = () => {
  const buffer = useBufferState();
  const [handle] = React.useState(() => delayRender());

  React.useEffect(() => {
    const delayHandle = buffer.delayPlayback();

    setTimeout(() => {
      delayHandle.unblock();
      continueRender(handle);
    }, 5000);

    return () => {
      delayHandle.unblock();
    };
  }, []);

  return <></>;
};
```

</details>

### å¯èƒ½çš„çŠ¶æ€

æ’­æ”¾å™¨æ˜¯å¦æ­£åœ¨ç¼“å†²ä¸ä¼šåœ¨å†…éƒ¨æ›´æ”¹`playing` / `paused`çŠ¶æ€ã€‚  
å› æ­¤ï¼Œæ’­æ”¾å™¨å¯ä»¥å¤„äºå››ç§æ’­æ”¾çŠ¶æ€ï¼š

<Step>1</Step> <code>playing && !buffering</code> <br />
<Step>2</Step> <code>playing && buffering</code> <br />
<Step>3</Step> <code>paused && !buffering</code> <br />
<Step>4</Step> <code>paused && buffering</code> <br />
<br />

åªæœ‰åœ¨çŠ¶æ€<InlineStep>1</InlineStep>æ—¶æ—¶é—´æ‰ä¼šå‘å‰æ¨è¿›ã€‚

---

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRemotionå°†æ ¹æ®æ’­æ”¾å™¨çš„çŠ¶æ€æ˜¾ç¤ºä»¥ä¸‹UIï¼š

<p>
  å½“å¤„äºçŠ¶æ€<InlineStep>1</InlineStep>æ—¶ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªæš‚åœæŒ‰é’®ã€‚ <br />
</p>
<p>
  å½“å¤„äºçŠ¶æ€<InlineStep>2</InlineStep>æ—¶ï¼Œé¦–å…ˆæ˜¾ç¤ºä¸€ä¸ªæš‚åœæŒ‰é’®ï¼Œç„¶åç»è¿‡{' '}
  <a href="#indicating-buffering-in-the-ui">å»¶è¿Ÿ</a>åï¼Œæ˜¾ç¤ºä¸€ä¸ª{' '}
  <a href="/docs/player/buffer-state#indicating-buffering-in-the-ui">å¯è‡ªå®šä¹‰çš„æ—‹è½¬å™¨</a>{' '}
  ã€‚
</p>

<p>å¦åˆ™ï¼Œå°†æ˜¾ç¤ºæ’­æ”¾æŒ‰é’®ã€‚</p>

æ‚¨å¯ä»¥å‘æ­¤æ·»åŠ å…¶ä»–UIï¼Œä¾‹å¦‚åœ¨æ’­æ”¾å™¨ç¼“å†²æ—¶åœ¨æ’­æ”¾å™¨ä¸Šå åŠ ä¸€ä¸ªæ—‹è½¬å™¨ã€‚

### ç›‘å¬ç¼“å†²äº‹ä»¶

å¦‚æœ`<Player />`è¿›å…¥ç¼“å†²çŠ¶æ€ï¼Œå®ƒå°†å‘å‡º`waiting`äº‹ä»¶ã€‚  
ä¸€æ—¦æ¢å¤ï¼Œå®ƒä¼šå‘å‡º`resume`äº‹ä»¶ã€‚

```tsx twoslash title="ç›‘å¬waitingå’Œresumeäº‹ä»¶"
// @allowUmdGlobalAccess
// @filename: ./remotion/MyVideo.tsx
export const MyVideo = () => <></>;

// @filename: index.tsx
// ---cut---
import {Player, PlayerRef} from '@remotion/player';
import {useEffect, useRef, useState} from 'react';
import {MyVideo} from './remotion/MyVideo';

export const App: React.FC = () => {
  const playerRef = useRef<PlayerRef>(null);
  const [buffering, setBuffering] = useState(false);

  useEffect(() => {
    const {current} = playerRef;
    if (!current) {
      return;
    }

    const onBuffering = () => {
      setBuffering(true);
    };
    const onResume = () => {
      setBuffering(false);
    };

    current.addEventListener('waiting', onBuffering);
    current.addEventListener('resume', onResume);
    return () => {
      current.removeEventListener('waiting', onBuffering);
      current.removeEventListener('resume', onResume);
    };
  }, [setBuffering]);

  return (
    <Player
      ref={playerRef}
      component={MyVideo}
      durationInFrames={120}
      compositionWidth={1920}
      compositionHeight={1080}
      fps={30}
    />
  );
};
```

## å…·æœ‰å†…ç½®ç¼“å†²çš„ç»„ä»¶

æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ç»„ä»¶ä¸Šå¯ç”¨ç¼“å†²ï¼š

- [`<Audio>`](/docs/audio#pausewhenbuffering) - æ·»åŠ `pauseWhenBuffering`å±æ€§
- [`<Video>`](/docs/video#pausewhenbuffering) - æ·»åŠ `pauseWhenBuffering`å±æ€§
- [`<OffthreadVideo>`](/docs/offthreadvideo#pausewhenbuffering) - æ·»åŠ `pauseWhenBuffering`å±æ€§
- [`<Img>`](/docs/img#pausewhenloading) - æ·»åŠ `pauseWhenLoading`å±æ€§

## åœ¨ UI ä¸­æŒ‡ç¤ºç¼“å†²

å½“æ’­æ”¾å™¨æ­£åœ¨ç¼“å†²æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ’­æ”¾æŒ‰é’®å°†è¢«ä¸€ä¸ªæ—‹è½¬å™¨æ›¿æ¢ã€‚  
ä¸ºäº†é˜²æ­¢ UI é—ªçƒï¼Œæ­¤æ—‹è½¬å™¨åªä¼šåœ¨æ’­æ”¾å™¨å¤„äºç¼“å†²çŠ¶æ€è¶…è¿‡ 300 æ¯«ç§’åæ˜¾ç¤ºã€‚

æ‚¨å¯ä»¥é€šè¿‡å°† [`bufferStateDelayInMilliseconds`](/docs/player/player#bufferstatedelayinmilliseconds) å±æ€§ä¼ é€’ç»™ `<Player />` ç»„ä»¶æ¥è‡ªå®šä¹‰ `300` æ¯«ç§’çš„è¶…æ—¶æ—¶é—´ã€‚

```tsx twoslash title="è®¾ç½®æ˜¾ç¤ºæ—‹è½¬å™¨çš„å»¶è¿Ÿæ—¶é—´"
// @allowUmdGlobalAccess
// @filename: ./remotion/MyVideo.tsx
export const MyVideo = () => <></>;

// @filename: index.tsx
// ---cut---
import {Player, PlayerRef} from '@remotion/player';
import {useEffect, useRef, useState} from 'react';
import {MyVideo} from './remotion/MyVideo';

export const App: React.FC = () => {
  return (
    <Player
      component={MyVideo}
      durationInFrames={120}
      compositionWidth={1920}
      compositionHeight={1080}
      fps={30}
      bufferStateDelayInMilliseconds={1000} // Or set to `0` to immediately show the spinner
    />
  );
};
```

åœ¨ Studio ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨ [é…ç½®æ–‡ä»¶](/docs/config#setbufferstatedelayinmilliseconds) ä¸­æ›´æ”¹å»¶è¿Ÿï¼š

```ts twoslash title="remotion.config.ts"
import {Config} from '@remotion/cli/config';

Config.setBufferStateDelayInMilliseconds(0);
```

è¦è‡ªå®šä¹‰æ˜¾ç¤ºåœ¨æ’­æ”¾æŒ‰é’®ä½ç½®çš„æ—‹è½¬å™¨ï¼Œæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ª [`renderPlayPauseButton()`](/docs/player/player#renderplaypausebutton) å±æ€§ï¼š

```tsx twoslash title="åœ¨æ’­æ”¾æŒ‰é’®å†…éƒ¨æ¸²æŸ“è‡ªå®šä¹‰æ—‹è½¬å™¨"
const MyPlayButton: React.FC = () => null;
const MyPauseButton: React.FC = () => null;
const MySpinner: React.FC = () => null;
const MyVideo: React.FC = () => null;
// ---cut---
import {Player, RenderPlayPauseButton} from '@remotion/player';
import {useCallback} from 'react';

export const App: React.FC = () => {
  const renderPlayPauseButton: RenderPlayPauseButton = useCallback(
    ({playing, isBuffering}) => {
      if (playing && isBuffering) {
        return <MySpinner />;
      }

      return null;
    },
    [],
  );

  return (
    <Player
      component={MyVideo}
      durationInFrames={120}
      compositionWidth={1920}
      compositionHeight={1080}
      fps={30}
      renderPlayPauseButton={renderPlayPauseButton}
    />
  );
};
```

è¦åœ¨æ’­æ”¾å™¨ä¸Šæ–¹æ˜¾ç¤ºä¸€ä¸ªå åŠ çš„åŠ è½½ UIï¼ˆä¾‹å¦‚æ—‹è½¬å™¨ï¼‰ï¼Œæ‚¨å¯ä»¥å°† [`showPosterWhenBuffering`](/docs/player/player#showposterwhenbuffering) è®¾ç½®ä¸º `true` å¹¶ä¼ é€’ä¸€ä¸ª [`renderPoster()`](/docs/player/player#renderposter) å±æ€§ï¼š

```tsx twoslash title="åœ¨æ’­æ”¾å™¨ä¸Šæ–¹æ¸²æŸ“è‡ªå®šä¹‰æ—‹è½¬å™¨"
import {useCallback} from 'react';
import {AbsoluteFill} from 'remotion';

const Component: React.FC = () => null;
const Spinner: React.FC = () => null;

// ---cut---

import type {RenderPoster} from '@remotion/player';
import {Player} from '@remotion/player';

const MyApp: React.FC = () => {
  const renderPoster: RenderPoster = useCallback(({isBuffering}) => {
    if (isBuffering) {
      return (
        <AbsoluteFill style={{justifyContent: 'center', alignItems: 'center'}}>
          <Spinner />
        </AbsoluteFill>
      );
    }

    return null;
  }, []);

  return (
    <Player
      fps={30}
      component={Component}
      durationInFrames={100}
      compositionWidth={1080}
      compositionHeight={1080}
      renderPoster={renderPoster}
      showPosterWhenBuffering
    />
  );
};
```

## Remotion 5.0 ä¸­å³å°†å‘ç”Ÿçš„æ›´æ”¹

åœ¨ Remotion 4.0 ä¸­ï¼Œåª’ä½“æ ‡ç­¾å¦‚ `<Audio>`ã€`<OffthreadVideo>` æ ‡ç­¾éœ€è¦é€‰æ‹©ä½¿ç”¨ç¼“å†²çŠ¶æ€ã€‚

åœ¨ Remotion 5.0 ä¸­ï¼Œè®¡åˆ’è®© `<Audio>`ã€`<Video>` å’Œ `<OffthreadVideo>` è‡ªåŠ¨ä½¿ç”¨ç¼“å†²çŠ¶æ€ï¼Œä½†å®ƒä»¬å¯ä»¥é€‰æ‹©é€€å‡ºã€‚

## å¦è¯·å‚é˜…

- [`useBufferState()`](/docs/use-buffer-state)
- [`<Player>`](/docs/player/player)
- [é¿å… `<Player>` ä¸­çš„é—ªçƒ](/docs/troubleshooting/player-flicker)

