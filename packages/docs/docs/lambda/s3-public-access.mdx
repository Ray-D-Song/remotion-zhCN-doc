---
image: /generated/articles-docs-lambda-s3-public-access.png
title: 无法使用 Remotion 创建 S3 存储桶
sidebar_label: 无法创建公共存储桶
crumb: DevOps 咨询
---

import {UserPolicy} from '../../components/lambda/user-permissions.tsx';

自 2023 年 4 月 25 日左右起，AWS 阻止创建公共存储桶而不进行额外配置，这使得使用 Remotion 版本 v3.3.86 及更早版本无法创建新的 S3 存储桶。

要使存储桶创建再次生效，您需要升级到更新的 Remotion 版本并更新您的用户策略。

## 问题

用户可能会看到以下错误：

```sh
InvalidBucketAclWithObjectOwnership: Bucket cannot have ACLs set with ObjectOwnership's BucketOwnerEnforced setting.
```

或者

```shell
AccessDenied: Access Denied
```

这些错误来自 AWS SDK，在尝试创建新站点或存储桶时出现。

## 原因

AWS 默认将所有存储桶设置为私有，而 Remotion 尝试创建一个公共存储桶。

## 解决方法

<Step>1</Step> 升级到 Remotion <code>v3.3.87</code> 或更高版本。 <br />
<br />

```bash
npx remotion upgrade
```

:::note
注意：升级 Remotion 后，您需要部署新函数。
:::

<Step>2</Step> 更改您的策略以授予用户 <code>s3:PutBucketOwnershipControls</code> 和 <code>s3:PutBucketPublicAccessBlock</code> 权限。 最简单的方法是复制以下用户策略： <br />
<br />

<details>
  <summary>
    显示最新 Remotion Lambda 版本的完整用户权限 JSON 文件
  </summary>
  <UserPolicy />
</details>

或者在升级 Remotion Lambda 后键入 `npx remotion lambda policies user`。

转到 AWS 控制台的 [用户](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/users) 部分，并用上述复制的 JSON 覆盖您的 Remotion Lambda 用户的 JSON 策略。

您可以通过运行 `npx remotion lambda policies validate` 来验证是否成功。

<Step>3</Step> 重新部署您的函数。 您无需删除旧函数，因为这可能会导致应用程序停机。 <br />

<Step>4</Step> 作为提醒，当您升级到更高的 Remotion 版本时，您还需要重新部署您的站点。 <br />

<Step>5</Step> 如果有任何硬编码的值，请在您的应用程序代码中更新函数和站点名称。

## 有问题吗？

加入我们的 [Discord](https://remotion.dev/discord) 社区，从 Remotion 团队和其他用户那里获取帮助。
