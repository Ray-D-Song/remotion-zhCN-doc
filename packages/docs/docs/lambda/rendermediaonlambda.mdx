---
image: /generated/articles-docs-lambda-rendermediaonlambda.png
id: rendermediaonlambda
title: renderMediaOnLambda()
crumb: "Lambda API"
---

import { MinimumFramesPerLambda } from "../../components/lambda/default-frames-per-lambda";

在 Remotion Lambda 上启动渲染过程。可以使用 [getRenderProgress()](/docs/lambda/getrenderprogress) 来跟踪进度。

需要已部署 [function](/docs/lambda/deployfunction) 来执行渲染。  
需要指定一个 [site](/docs/lambda/deploysite) 或 [Serve URL](/docs/terminology/serve-url) 来确定将要渲染的内容。

## 示例

```tsx twoslash
// @module: esnext
// @target: es2017
// ---cut---
import { renderMediaOnLambda } from "@remotion/lambda/client";

const { bucketName, renderId } = await renderMediaOnLambda({
  region: "us-east-1",
  functionName: "remotion-render-bds9aab",
  composition: "MyVideo",
  serveUrl:
    "https://remotionlambda-qg35eyp1s1.s3.eu-central-1.amazonaws.com/sites/bf2jrbfkw",
  codec: "h264",
});
```

:::note
最好从 `@remotion/lambda/client` 中导入此函数，以避免在 [无服务器函数](/docs/lambda/light-client) 中出现问题。
:::

## 参数

一个具有以下属性的对象：

### `region`

Lambda 函数部署的区域。强烈建议您的 Remotion 站点也位于同一区域。

### `privacy`

_自 v3.2.27 起可选_

其中之一：

- `"public"`（_默认_）：渲染的媒体可以通过 S3 URL 公开访问。
- `"private"`：渲染的媒体不是公开的，但可以使用 [presignUrl()](/docs/lambda/presignurl) 创建签名链接。
- `"no-acl"`（_从 v.3.1.7 起可用_）：不设置 ACL 选项，如果您要写入不支持 ACL 的另一个存储桶，可以使用 [`outName`](#outname)。

### `functionName`

部署的 Lambda 函数的名称。
使用 [`deployFunction()`](/docs/lambda/deployfunction) 创建新函数，使用 [`getFunctions()`](/docs/lambda/getfunctions) 获取当前部署的 Lambdas。

### `framesPerLambda?`

_可选_

视频渲染过程分布在多个 Lambda 函数中。此设置控制每个 Lambda 调用渲染多少帧。传递的数字越低，生成的 Lambda 就越多。

默认值：[取决于视频长度](/docs/lambda/concurrency)  
最小值：<MinimumFramesPerLambda />

```markdown
:::note
`framesPerLambda` 参数不能导致生成超过 200 个函数。参见：[并发性](/docs/lambda/concurrency)
:::

### `frameRange?`

_number | [number, number] - 可选_

指定单个帧（传递一个 `number`）或一系列帧（传递一个元组 `[number, number]`）以渲染视频的子集。例如：`[0, 9]` 选择前 10 帧。通过传递 `null`（默认）来渲染合成的所有帧。要渲染静态图，请使用 [`renderStillOnLambda()`](/docs/lambda/renderstillonlambda)。

### `serveUrl`

指向 Remotion 项目的 URL。使用 [`deploySite()`](/docs/lambda/deploysite) 部署 Remotion 项目。

### `composition`

您要渲染的[合成](/docs/composition)的 `id`。

### `inputProps`

_自 v3.2.27 起可选_

[要传递给视频所选合成的输入属性。](/docs/passing-props#passing-input-props-in-the-cli)  
必须是 JSON 对象。  
从根组件中，可以使用 [`getInputProps()`](/docs/get-input-props) 读取属性。  
您可以使用 [`calculateMetadata()`](/docs/calculate-metadata) 转换输入属性。

### `codec`

应使用哪种编解码器来编码视频。

支持视频编解码器 `h264` 和 `vp8`，自 `v3.2.0` 起支持 `prores`。`h265` 支持已在 `v4.0.32` 中添加。

音频编解码器 `mp3`、`aac` 和 `wav` 也受支持。

自 `v3.3.34` 起，选项 `h264-mkv` 已更名为 `h264`。使用 `h264` 可获得相同的行为。

另请参见 [`renderMedia() -> codec`](/docs/renderer/render-media#codec)。

### `audioCodec?`

_可选_
_"pcm-16" | "aac" | "mp3" | "opus"，自 v3.3.41 起可用_

选择音频的编码方式。

- 每个 Lambda 块实际上可能会选择一种无损编解码器，并在最终编码阶段将其转换为避免音频伪影。
- 默认取决于所选的 `codec`。
- 如果需要无损音频，请选择 `pcm-16`。
- 并非所有视频容器都支持所有音频编解码器。
- 如果 `codec` 选项还指定了音频编解码器，则此选项优先。

```

请参考[编码指南](/docs/encoding/#audio-codec)查看默认值和支持的组合。

### `forceHeight?`

_可选，自 v3.2.40 起可用_

覆盖默认合成高度。

### `forceWidth?`

_可选，自 v3.2.40 起可用_

覆盖默认合成宽度。

### `muted?`

_可选_

禁用音频输出。另请参阅[`renderMedia() -> muted`](/docs/renderer/render-media#muted)。

### `imageFormat`

_自 v3.2.27 起可选_

参见[`renderMedia() -> imageFormat`](/docs/renderer/render-media#imageformat)。

### `crf?`

_可选_

参见[`renderMedia() -> crf`](/docs/renderer/render-media#crf)。

### `envVariables?`

_可选_

参见[`renderMedia() -> envVariables`](/docs/renderer/render-media#envvariables)。

### `pixelFormat?`

_可选_

参见[`renderMedia() -> pixelFormat`](/docs/renderer/render-media#pixelformat)。

### `proResProfile?`

_可选_

参见[`renderMedia() -> proResProfile`](/docs/renderer/render-media#proresprofile)。

### `x264Preset?`

_可选_

<Options id="x264-preset" />

### `jpegQuality`

参见[`renderMedia() -> jpegQuality`](/docs/renderer/render-media#jpegquality)。

### ~~`quality`~~

在 v4.0.0 中更名为 `jpegQuality`。

### `audioBitrate?`

_可选_

<Options id="audio-bitrate" />

### `videoBitrate?`

_可选_

<Options id="video-bitrate" />

### `bufferSize?`<AvailableFrom v="4.0.78" />

<Options id="buffer-size" />

### `maxRate?`<AvailableFrom v="4.0.78" />

<Options id="max-rate" />

### `maxRetries`

_自 v3.2.27 起可选，默认为 `1`_

在渲染失败的情况下，一个块可以重试渲染的次数。
如果一个块的渲染失败，错误将在[`getRenderProgress()`](/docs/lambda/getrenderprogress)对象中报告，并根据您使用此选项指定的次数重试。

:::note
只有当错误在[易出错错误列表](https://github.com/remotion-dev/remotion/blob/main/packages/lambda/src/shared/is-flaky-error.ts)中时，才会执行重试。
:::

### `scale?`

_可选_

通过因子缩放输出尺寸。请参阅[缩放](/docs/scaling)以了解更多关于此功能的信息。

### `outName?`

_可选_

媒体输出的文件名。

可以是：

- `undefined` - 默认为 `out` 加上适当的文件扩展名，例如：`renders/${renderId}/out.mp4`。
- 一个 `string` - 将保存到与您的站点相同的 S3 存储桶下的键 `renders/{renderId}/{outName}`。请确保在字符串末尾包含文件扩展名。
- 如果要渲染到不同的存储桶或云提供商，则为对象 - [请参阅此处获取详细说明](/docs/lambda/custom-destination)。

### `timeoutInMilliseconds?`

_可选_

描述渲染可能需要多长时间来解析所有 [`delayRender()`](/docs/delay-render) 调用 [在超时之前](/docs/timeout)。默认值：`30000`

### `concurrencyPerLambda?`

_可选，自 v3.0.30 起可用_

默认情况下，每个 Lambda 函数以并发 1（一个打开的浏览器选项卡）进行渲染。您可以使用此选项来自定义此值。

### `everyNthFrame?`

_可选，自 v3.1 起可用_

仅渲染每第 n 帧。例如，仅每第二帧，每第三帧等。仅适用于渲染 GIF。[请参阅此处获取更多详细信息。](/docs/render-as-gif)

### `numberOfGifLoops?`

_可选，自 v3.1 起可用_

<Options id="number-of-gif-loops" />

### `downloadBehavior?`

_可选，自 v3.1.5 起可用_

在通过浏览器中的 S3 输出链接访问输出文件时的行为。  
要么：

- `{"type": "play-in-browser"}` - 默认选项。视频将在浏览器中播放。
- `{"type": "download", fileName: null}` 或 `{"type": "download", fileName: "download.mp4"}` - 将添加一个 `Content-Disposition` 头，使浏览器下载文件。您可以选择性地覆盖文件名。

### `chromiumOptions?`

允许您设置某些 Chromium / Google Chrome 标志。参见：[Chromium 标志](/docs/chromium-flags)。

#### `disableWebSecurity`

_boolean - 默认 `false`_

这将主要禁用 CORS 和其他安全功能。

#### `ignoreCertificateErrors`

_boolean - 默认 `false`_ 



结果会忽略无效的 SSL 证书，比如自签名证书。

#### `gl`

<Options id="gl" />

### `overwrite?`

_从 v3.2.25 版本开始可用_

如果指定了自定义输出名称，并且 S3 存储桶中已经存在该键对应的文件，则决定是否覆盖该文件。默认为 `false`。  
如果文件已存在且 `overwrite` 为 `false`，则会抛出错误。

### `rendererFunctionName?`

_可选，从 v3.3.38 版本开始可用_

如果指定了此函数，将用于渲染单个块。如果要使用比主协调函数具有更高或更低权限的函数来渲染块，这将非常有用。

如果要使用此选项，函数必须与主函数在同一区域、同一帐户并且具有相同的版本。

### `webhook?`

_可选，从 v3.2.30 版本开始可用_

如果指定了，Remotion 将向提供的端点发送 POST 请求，以通知您的应用程序 Lambda 渲染过程何时完成、出错或超时。

```tsx twoslash
import { RenderMediaOnLambdaInput } from "@remotion/lambda";

const webhook: RenderMediaOnLambdaInput["webhook"] = {
  url: "https://mapsnap.app/api/webhook",
  secret: process.env.WEBHOOK_SECRET as string,
  // Optionally pass up to 1024 bytes of custom data
  customData: {
    id: 42,
  },
};
```

如果不想设置验证，可以将 `secret` 设置为 null：

```tsx twoslash
import { RenderMediaOnLambdaInput } from "@remotion/lambda";

const webhook: RenderMediaOnLambdaInput["webhook"] = {
  url: "https://mapsnap.app/api/webhook",
  secret: null,
};
```

[点击此处查看如何设置您的 webhook 的详细说明](/docs/lambda/webhooks)。

### `forceBucketName?`

_可选，从 v3.3.42 版本开始可用_

指定要使用的特定存储桶名称。[不建议这样做](/docs/lambda/multiple-buckets)，而是让 Remotion 自动发现正确的存储桶。

### `logLevel?`

<Options id="log" />

如果 `logLevel` 设置为 `verbose`，Lambda 函数将不会清理工件，以帮助调试。除非您正在调试问题，否则不要使用它。

### `offthreadVideoCacheSizeInBytes?`<AvailableFrom v="4.0.23"/>

<Options id="offthreadvideo-cache-size-in-bytes" />

### `colorSpace?`<AvailableFrom v="4.0.28"/>

<Options id="color-space" />

### `deleteAfter?`<AvailableFrom v="4.0.32"/>

<Options id="delete-after" />

### `preferLossless?`<AvailableFrom v="4.0.123"/>

<Options id="prefer-lossless" />

### `forcePathStyle?`<AvailableFrom v="4.0.202" />

将 `forcePathStyle` 传递给 AWS S3 客户端。如果您不知道这是什么，您可能不需要它。

### ~~`dumpBrowserLogs?`~~

_可选 - 默认为 `false`，在 v4.0 中已弃用_

已弃用，建议使用 [`logLevel`](#loglevel)。

## 返回值

返回一个解析为包含四个属性的对象的 Promise。其中，`renderId`、`bucketName` 对于传递给 `getRenderProgress()` 是有用的。

### `renderId`

此渲染的唯一字母数字标识符。用于获取状态并在 S3 存储桶中找到相关文件。

### `bucketName`

正在保存所有文件的 S3 存储桶名称。

### `cloudWatchLogs`<AvailableFrom v="3.2.10"/>

一个指向 CloudWatch 的链接（如果您未禁用它），您可以访问以查看渲染的日志。

### `lambdaInsightsUrl`<AvailableFrom v="4.0.61"/>

一个指向 [Lambda Insights](/docs/lambda/insights) 的链接，如果您已启用。

### `folderInS3Console`<AvailableFrom v="3.2.43"/>

一个指向 AWS 控制台中每个块和渲染所在文件夹的链接。

## 参见

- [此函数的源代码](https://github.com/remotion-dev/remotion/blob/main/packages/lambda/src/api/render-media-on-lambda.ts)
- [getRenderProgress()](/docs/lambda/getrenderprogress)
