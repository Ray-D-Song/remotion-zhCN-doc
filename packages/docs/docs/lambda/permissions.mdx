---
image: /generated/articles-docs-lambda-permissions.png
sidebar_label: 权限
title: 权限
crumb: 'Lambda'
---


import {UserPolicy} from '../../components/lambda/user-permissions.tsx';
import {RolePolicy} from '../../components/lambda/role-permissions.tsx';

本文描述了 Remotion Lambda 所需的权限，并向感兴趣的人解释了为什么这些权限是必要的。

要逐步设置权限，请参阅[设置指南](/docs/lambda/setup)。

## 用户权限

此策略应分配给 **AWS 用户**。要这样做，请转到[AWS 控制台](https://console.aws.amazon.com/console/home) ➞ [IAM](https://console.aws.amazon.com/iam/home) ➞ [用户](https://console.aws.amazon.com/iamv2/home#/users) ➞ 您创建的 Remotion 用户 ➞ 权限选项卡 ➞ 添加内联策略 ➞ JSON。

<details>
  <summary>
    显示最新 Remotion Lambda 版本的完整用户权限 JSON 文件
  </summary>
  <UserPolicy />
</details>

:::info
您可以通过输入 `npx remotion lambda policies user` 获取适合您的 Remotion Lambda 版本的权限文件。
:::

## 角色权限

此策略应分配给您 AWS 帐户中的 **角色 `remotion-lambda-role`**。以下权限授予 Lambda 函数本身。

要分配，请转到[AWS 控制台](https://console.aws.amazon.com/console/home) ➞ [IAM](https://console.aws.amazon.com/iam/home) ➞ [角色](https://console.aws.amazon.com/iamv2/home#/roles) ➞ [`remotion-lambda-role`](https://console.aws.amazon.com/iam/home#/roles/remotion-lambda-role) ➞ 权限选项卡 ➞ [添加内联策略](https://console.aws.amazon.com/iam/home#/roles/remotion-lambda-role$createPolicy?step=edit)。

<details>
  <summary>
    显示最新 Remotion Lambda 版本的完整角色权限 JSON 文件
  </summary>
  <RolePolicy />
</details>

:::info
您可以通过输入 `npx remotion lambda policies role` 获取适合您的 Remotion Lambda 版本的权限文件。
:::

## 验证

有两种方式可以测试用户权限是否已正确设置。您可以执行以下命令：

```bash
npx remotion lambda policies validate
```

或者如果您想以编程方式进行验证，可以使用[`simulatePermissions()`](/docs/lambda/simulatepermissions)函数。

:::info
无法验证角色的策略。
:::

## 解释

以下表格详细说明了为什么 Remotion Lambda 需要它所需的权限。

### 用户策略

<table>
  <tr>
    <th>
      权限
    </th>
    <th>
      范围
    </th>
    <th>
      原因
    </th>
  </tr>
  <tr>
    <td>
      <code>iam:SimulatePrincipalPolicy</code>
    </td>
    <td><code>*</code></td>
    <td>
      允许执行 <code>npx remotion lambda permissions validate</code>。
    </td>
  </tr>
  <tr>
    <td>
      <code>iam:PassRole</code>
    </td>
    <td><code>arn:aws:iam::*:role/remotion-lambda-role</code></td>
    <td>
    允许 Lambda 函数假定具有足够权限的角色。
    </td>
  </tr>
  <tr>
    <td>
      <code>s3:GetObject</code> <br />
      <code>s3:DeleteObject</code> <br />
      <code>s3:PutObjectAcl</code> <br />
      <code>s3:PutObject</code> <br />
      <code>s3:CreateBucket</code> <br/>
      <code>s3:ListBucket</code> <br />
      <code>s3:GetBucketLocation</code> <br />
      <code>s3:PutBucketAcl</code> <br />
      <code>s3:DeleteBucket</code> <br />
      <code>s3.PutBucketOwnershipControls</code> <br />
      <code>s3.PutBucketPublicAccessBlock</code> <br />
    </td>
    <td>
      <code>{'arn:aws:s3:::remotionlambda-*'}</code>
    </td>
    <td>
      允许在您的帐户中创建和删除存储桶和对象，使对象公开并将其配置为网站。只能访问以 <code>remotionlambda-</code> 开头的存储桶。
    </td>
  </tr>
  <tr>
    <td>
      <code>s3:ListAllMyBuckets</code>
    </td>
    <td>
      <code>{'arn:aws:s3:::*'}</code>
    </td>
    <td>
      允许列出您帐户中所有存储桶的名称，以便检测已存在的 Remotion 存储桶。
    </td>
  </tr>

  <tr>
    <td>
      <code>lambda:GetLayerVersion</code>
    </td>
    <td>
      <code>{"arn:aws:lambda:*:678892195805:layer:remotion-binaries-*"}</code>
    </td>
    <td>
    允许读取 Chromium 和 FFMPEG 二进制文件。这些二进制文件托管在 Remotion 专门用于在所有支持的区域中托管这些层的帐户中。
    </td>
  </tr>
  <tr>
    <td>
      <code>lambda:ListFunctions</code> <br/>
      <code>lambda:GetFunction</code> <br/>
    </td>
    <td>
      <code>{"*"}</code>
    </td>
    <td>
    允许读取您 AWS 帐户中的函数，以便找到要调用的正确函数。宽松的 <code>*</code> 权限是因为 AWS 不允许收紧此权限。
    </td>
  </tr>
  <tr>
    <td>
      <code>lambda:InvokeAsync</code> <br/>
      <code>lambda:InvokeFunction</code> <br/>
      <code>lambda:DeleteFunction</code> <br/>
      <code>lambda:PutFunctionEventInvokeConfig</code> <br/>
      <code>lambda:CreateFunction</code> <br/>
      <code>lambda:PutRuntimeManagementConfig</code> <br/>
      <code>lambda:TagResource</code> <br/>
    </td>
    <td>
      <code>{"arn:aws:lambda:*:*:function:remotion-render-*"}</code>
    </td>
    <td>
    允许创建、删除、调用和配置函数（例如禁用自动重试）。CLI 和 Node.JS API 使用这些权限来设置、执行和拆卸基础设施。<code>lambda:TagResource</code> 可以选择性地为函数打标签。
    </td>
  </tr>
  <tr>
    <td>
      <code>logs:CreateLogGroup</code> <br/>
      <code>logs:PutRetentionPolicy</code>
    </td>
    <td>
      <code>{"arn:aws:logs:*:*:log-group:/aws/lambda/remotion-render-*"}</code>
    </td>
    <td>
    允许创建 CloudWatch 组，以便稍后将日志保存在其中。简化调试。
    </td>
  </tr>
  <tr>
    <td>
      <code>servicequotas:GetServiceQuota</code> <br/>
      <code>servicequotas:GetAWSDefaultServiceQuota</code> <br/>
      <code>servicequotas:RequestServiceQuotaIncrease</code> <br/>
      <code style={{wordBreak: 'break-all'}}>servicequotas:ListRequestedServiceQuotaChangeHistoryByQuota</code> <br/>
    </td>
    <td>
      <code>{"*"}</code>
    </td>
    <td>
    为 <code>lambda quotas</code> CLI 命令提供支持。
    </td>
  </tr>
</table>

### 角色策略

<table>
  <tr>
    <th>
      权限
    </th>
    <th>
      范围
    </th>
    <th>
      原因
    </th>
  </tr>
  <tr>
    <td>
      <code>s3.ListAllMyBuckets</code>
    </td>
    <td>
      <code>{"*"}</code>
    </td>
    <td>
    获取 Remotion 存储桶列表，以查找以 <code>remotionlambda-</code> 开头的现有存储桶。
    </td>
  </tr>
  <tr>
    <td>
      <code>s3:CreateBucket</code> <br/>
      <code>s3:ListBucket</code> <br/>
      <code>s3:PutBucketAcl</code> <br/>
      <code>s3:GetObject</code> <br/>
      <code>s3:DeleteObject</code> <br/>
      <code>s3:PutObjectAcl</code> <br/>
      <code>s3:PutObject</code> <br/>
      <code>s3:GetBucketLocation</code> 
    </td>
    <td>
      <code>{"arn:aws:s3:::remotionlambda-*"}</code>
    </td>
    <td>
  创建和删除存储桶和项目，使其公开或私有，并获取其位置。由于 Remotion 将视频存储在 S3 存储桶中，因此需要对这些存储桶具有基本的 CRUD 能力。该权限仅适用于以 <code>remotionlambda-</code> 开头的存储桶。
    </td>
  </tr>
  <tr>
    <td>
      <code>lambda:InvokeFunction</code> <br/>
    </td>
    <td>
      <code>{"arn:aws:lambda:*:*:function:remotion-render*"}</code>
    </td>
    <td>
允许函数递归调用自身。渲染涉及多个函数调用，由第一个函数调用进行编排。
    </td>

  </tr>
  <tr>
    <td>
      <code>lambda:CreateLogStream</code> <br/>
      <code>lambda:PutLogEvents</code> <br/>
    </td>
    <td>
      <code>{"arn:aws:logs:*:*:log-group:/aws/lambda/remotion-render*"}</code>
    </td>
    <td>
允许将函数日志写入 CloudWatch 以便更轻松地进行调试。
    </td>

  </tr>
 
</table>

## 参见

- [设置指南](/docs/lambda/setup)
- [`simulatePermissions()`](/docs/lambda/simulatepermissions)
- [权限故障排除](/docs/lambda/troubleshooting/permissions)
