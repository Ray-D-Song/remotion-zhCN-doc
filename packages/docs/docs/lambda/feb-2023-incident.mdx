---
image: /generated/articles-docs-lambda-feb-2023-incident.png
title: 升级您的 Lambda 函数以防止故障
sidebar_label: 2023 年 2 月事件
crumb: DevOps 咨询
---

import {UserPolicy} from '../../components/lambda/user-permissions.tsx';

:::info
在 Remotion 4.0 中，此问题已得到解决。
:::

2023 年 2 月 24 日，AWS Lambda Node.JS 运行时的新版本开始推出，导致 Remotion Lambda 出现故障。  
建议 Remotion Lambda 用户阅读本文档，以避免任何停机时间。

## 问题

用户可能会看到错误：

```bash
Error: expected to launch
```

或者

```bash
Failed to launch the browser process!



TROUBLESHOOTING: https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md
```

## 原因

AWS Lambda 已经将其 Node.JS 的 Lambda 运行时更新从 `v14.28` 更新到 `v14.29`。  
此更新导致无头 Chromium 浏览器因尚未知原因而退出并显示 `SIGBUS` 错误。

## 建议

我们建议**不要部署任何新函数**，直到问题得到解决，因为新函数可能会使用新的运行时。  
由于在稍后的时间点，AWS 将会将新运行时推送给所有现有函数，我们建议尽快升级到 Remotion `3.3.54` 或更高版本，并重新部署您的函数。

## 解决方案

### 选项 1: `v3.3.54` 更新（推荐）

在 Remotion `v3.3.54` 中，Remotion 将锁定 AWS Lambda Node.JS 运行时为 `v14.28`，以防止出现此问题。  
自 2023 年 1 月 23 日起，才有可能在 AWS Lambda 上锁定运行时，这也是我们现在才发布此更新的原因。

要应用此修复，您需要：

<Step>1</Step> 升级 Remotion: <br />
<br />

```bash
npx remotion upgrade
```

<Step>2</Step> 更改您的策略，以授予您的用户 <code>
  lambda:PutRuntimeManagementConfig
</code> 权限。最简单的方法是复制以下用户策略： <br />
<br />

<details>
  <summary>
    显示最新 Remotion Lambda 版本的完整用户权限 JSON 文件
  </summary>
  <UserPolicy />
</details>

或者在升级 Remotion Lambda 后键入 `npx remotion lambda policies user`。

转到 AWS 控制台的 [用户](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/users) 部分，并用上述复制的 JSON 覆盖您的 Remotion Lambda 用户的 JSON 策略。

<Step>3</Step> 重新部署您的函数。您无需删除旧函数，因为这可能会导致应用程序停机。 <br />

<Step>4</Step> 作为提醒，当您升级到更高的 Remotion 版本时，您还需要重新部署您的站点。 <br />

<Step>5</Step> 如果有任何硬编码的值，请在您的应用程序代码中更新函数和站点名称。

### 选项 2：在 AWS 控制台中手动更新运行时

或者，对于每个 Lambda 函数，您可以在 AWS 控制台中锁定运行时版本：

<Step>1</Step> 转到 AWS 仪表板中的函数，然后单击“编辑运行时管理配置”。
<br />
<br />

<img src="/img/runtimesettings.png" />

<Step>2</Step> 将其设置为“手动”。 <br />

<Step>3</Step> 将运行时设置为 <code>arn:aws:lambda:[region]::runtime:69000d3430a08938bcab71617dffcb8ea551a2cbc36c59f38c52a1ea087e461b</code>。将 <code>[region]</code> 替换为 AWS 区域的代码（例如 <code>us-east-1</code>） <br />

<Step>4</Step> 单击“保存”。对您部署的任何函数都要重复此操作。

## 长期解决方案

我们已升级到 AWS 商业支持层，并与他们联系，让他们意识到这个问题，并希望尽快合作解决。

由于最近可以锁定 AWS Lambda 运行时版本，我们将从现在开始使用此选项，使 Remotion 更具抗性，以应对未来的运行时更新。

## 有问题吗？

加入我们的 [Discord](https://remotion.dev/discord) 社区，从 Remotion 团队和其他用户那里获取帮助。
