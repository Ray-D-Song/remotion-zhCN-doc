---
image: /generated/articles-docs-cloudrun-rendermediaoncloudrun.png
id: rendermediaoncloudrun
title: renderMediaOnCloudrun()
crumb: "Cloud Run API"
---

<ExperimentalBadge>
  <p>
    Cloud Run 处于 <a href="/docs/cloudrun-alpha">Alpha</a> 阶段，这意味着 API 可能会在任何版本中更改，文档尚未完成。请查看{' '}<a href="https://remotion.dev/changelog">更改日志</a> 以了解最新的重大更改。
  </p>
</ExperimentalBadge>

在 Remotion Cloud Run 上启动媒体渲染过程。

需要已部署 [服务](/docs/cloudrun/deployservice) 才能执行渲染。  
需要指定一个 [站点](/docs/cloudrun/deploysite) 或 [Serve URL](/docs/terminology/serve-url) 来确定将要渲染的内容。

## 示例

```tsx twoslash
// @module: esnext
// @target: es2017
// ---cut---
import { renderMediaOnCloudrun } from "@remotion/cloudrun/client";

const result = await renderMediaOnCloudrun({
  region: "us-east1",
  serviceName: "remotion-render-bds9aab",
  composition: "MyVideo",
  serveUrl:
    "https://storage.googleapis.com/remotioncloudrun-123asd321/sites/abcdefgh",
  codec: "h264",
});

if (result.type === "success") {
  console.log(result.bucketName);
  console.log(result.renderId);
}
```

:::note
从 [`@remotion/cloudrun/client`](/docs/cloudrun/light-client) 导入，以避免加载整个渲染器，因为它无法捆绑。
:::

## 参数

一个具有以下属性的对象：

### `cloudRunUrl?`

_可选。如果未提供 serviceName，则必填_

应用于执行渲染的 Cloud Run 服务的 URL。您必须设置 cloudRunUrl 或 serviceName，但不能同时设置两者

### `serviceName?`

_可选。如果未提供 cloudRunUrl，则必填_

应用于执行渲染的 Cloud Run 服务的名称。这与区域一起用于确定服务端点，因为相同的服务名称可以存在于多个区域。

### `region`

您的 Cloud Run 服务部署在哪个 [GCP 区域](/docs/cloudrun/region-selection)。强烈建议您的 Remotion 站点也位于同一区域。

### `serveUrl`

指向 Remotion 项目的 URL。使用 [`deploySite()`](/docs/cloudrun/deploysite) 部署 Remotion 项目。

### `composition`

要渲染的 [composition](/docs/composition) 的 `id`。

### `codec`

应使用哪种编解码器来编码视频。

支持视频编解码器 `h264`、`vp8` 和 `prores`。

音频编解码器 `mp3`、`aac` 和 `wav` 也受支持。

请参阅[`renderMedia() -> codec`](/docs/renderer/render-media#codec)。

### `inputProps?`

_可选_

[要传递给视频选定组合的输入属性。](/docs/passing-props#passing-input-props-in-the-cli)。  
必须是一个 JSON 对象。  
从根组件可以使用[`getInputProps()`](/docs/get-input-props)读取属性。  
您可以使用[`calculateMetadata()`](/docs/calculate-metadata)来转换输入属性。

### `privacy?`

_可选_

其中之一：

- `"public"`（_默认_）：渲染的媒体可以在 Cloud 存储 URL 下公开访问。
- `"private"`：渲染的媒体不是公开可用的，但对具有正确权限的 GCP 项目内的人员可用。

### `forceBucketName?`

_可选_

指定要用于输出的特定存储桶名称。生成的 Google Cloud 存储 URL 将采用格式 `gs://{bucket-name}/renders/{render-id}/{file-name}`。如果未设置，Remotion 将根据区域选择要使用的正确存储桶。

### `updateRenderProgress?`

_可选_

一个回调，用于呈现进度。

### `audioCodec?`

_可选_

选择音频的编码方式。

- 如果需要未压缩音频，请选择 `pcm-16`。
- 并非所有视频容器都支持所有音频编解码器。
- 如果 `codec` 选项还指定了音频编解码器，则此选项优先。

请参阅[编码指南](/docs/encoding/#audio-codec)以查看默认值和支持的组合。

### `jpegQuality?`

_可选_

请参阅[`renderMedia() -> jpegQuality`](/docs/renderer/render-media#jpegquality)。

### `audioBitrate?`

_可选_

<Options id="audio-bitrate" />

### `videoBitrate?`

_可选_

<Options id="video-bitrate" />

### `bufferSize?`<AvailableFrom v="4.0.78" />

<Options id="buffer-size" />

### `maxRate?`<AvailableFrom v="4.0.78" />

<Options id="max-rate" />

### `proResProfile?`

_可选_

请参阅[`renderMedia() -> proResProfile`](/docs/renderer/render-media#proresprofile)。

_可选_

### `x264Preset?`

<Options id="x264-preset" />

### `crf?`

_可选_

查看[`renderMedia() -> crf`](/docs/renderer/render-media#crf)。

### `pixelFormat?`

_可选_

查看[`renderMedia() -> pixelFormat`](/docs/renderer/render-media#pixelformat)。

### `imageFormat?`

_可选_

查看[`renderMedia() -> imageFormat`](/docs/renderer/render-media#imageformat)。

### `scale?`

_可选_

通过因子缩放输出尺寸。查看[缩放](/docs/scaling)以了解更多关于此功能的信息。

### `everyNthFrame?`

_可选_

仅渲染每第n帧。例如，仅每第二帧，每第三帧等。仅适用于渲染GIF。[点击此处了解更多详情。](/docs/render-as-gif)

### `numberOfGifLoops?`

_可选_

<Options id="number-of-gif-loops" />

_可选，自v3.1.5起可用_

在浏览器中通过S3输出链接访问输出文件时的行为。  
要么：

### `downloadBehavior?`<AvailableFrom v="4.0.176"/>

在浏览器中通过云存储输出链接访问输出文件时的行为。

- `{"type": "play-in-browser"}` - 默认行为。视频将在浏览器中播放。
- `{"type": "download", fileName: null}` 或 `{"type": "download", fileName: "download.mp4"}` - 将添加`Content-Disposition`头，使浏览器下载文件。您可以选择性地覆盖文件名。

### `frameRange?`

_可选_

指定要渲染的单个帧（数字）或帧范围（元组 [数字, 数字]）。

### `envVariables?`

_可选_

查看[`renderMedia() -> envVariables`](/docs/renderer/render-media#envvariables)。

### `chromiumOptions?`

_可选_

允许您设置某些Chromium / Google Chrome标志。查看：[Chromium标志](/docs/chromium-flags)。

#### `disableWebSecurity`

_boolean - 默认 `false`_

这将主要禁用CORS等安全功能。

#### `ignoreCertificateErrors`

_boolean - 默认 `false`_

导致无效的SSL证书（如自签名证书）被忽略。

#### `gl`

<Options id="gl" />

### `muted?`

_可选_

禁用音频输出。另请参阅[`renderMedia() -> muted`](/docs/renderer/render-media#muted)。

### `forceWidth?`

_可选_

覆盖默认合成宽度。



### `forceHeight?`

_可选_

覆盖默认合成高度。



### `logLevel?`

<Options id="log" />



### `outName?`

_可选_

媒体输出文件名。

可以是：

- `undefined` - 默认为 `out` 加上适当的文件扩展名，例如：`renders/${renderId}/out.mp4`。
- 一个 `string` - 将保存到与您的站点相同的云存储桶中，键为 `renders/{renderId}/{outName}`。请确保在字符串末尾包含文件扩展名。



### `delayRenderTimeoutInMilliseconds?`

_可选_

描述渲染可能需要多长时间来解析所有 [`delayRender()`](/docs/delay-render) 调用[在超时之前](/docs/timeout)。默认值：`30000`



### `concurrency?`

描述应打开多少个浏览器选项卡的数字或字符串。默认值为 "50%"。

:::note
在 v4.0.76 之前，默认值为 "100%"。现在已与其他服务器端渲染 API 对齐。
:::



### `enforceAudioTrack?`

如果没有其他情况，则渲染静音音轨。



### `preferLossless?`<AvailableFrom v="4.0.123"/>

<Options id="prefer-lossless" />



### `offthreadVideoCacheSizeInBytes?`<AvailableFrom v="4.0.23"/>

<Options id="offthreadvideo-cache-size-in-bytes" />



### `colorSpace?`<AvailableFrom v="4.0.28"/>

<Options id="color-space" />



## 返回值

返回一个解析为对象的 Promise。

### `type`

使用此项确定响应的结构。可以是：

- 'success' - 渲染已成功执行。
- 'crash - Cloud Run 服务已崩溃。



## 当 type === 'success' 时返回

结果对象包含以下内容：

### `type`

'success' - 渲染已成功执行。

### `publicUrl?`

_可选_

渲染文件的公共可访问 URL。仅当请求设置了 [`privacy`](/docs/cloudrun/rendermediaoncloudrun#privacy) 属性为 'public' 时可用。

### `renderId`

此渲染的唯一字母数字标识符。用于获取状态并在云存储桶中找到相关文件。

### `bucketName`

所有文件保存在其中的 Cloud Storage 存储桶名称。



### `privacy`

输出文件的隐私设置，可以是：

- "public-read" - 在 Cloud Storage URL 下公开访问。
- "project-private" - 不公开，但在 GCP 项目中对具有正确权限的用户可用。



### `publicUrl`

如果隐私设置为公开，则这将是渲染文件的公开访问 URL。如果隐私不是公开，则为 null。



### `cloudStorageUri`

Google Storage 路径，以 `gs://{bucket-name}` 开头。可与 [gsutil](https://cloud.google.com/storage/docs/gsutil) CLI 工具一起使用。



### `size`

以 KB 为单位的渲染媒体的大小。



## 当 type === 'crash' 时返回

生成的对象包含以下内容：

### `type`

'crash' - Cloud Run 服务在没有响应的情况下崩溃。



### `cloudRunEndpoint`

执行渲染时调用的端点。CLI 用于解析服务名称以确定服务的超时和内存限制。这在分析日志时可以用来提供有关崩溃原因的提示。



### `message`

'服务在没有发送响应的情况下崩溃。请检查 GCP 控制台中的日志。' 这用于 CLI 显示错误消息。



### `requestStartTime`

请求发起的日期时间，采用 UTC 格式 - "2020-01-01T00:00:00+02:00"。可用于过滤服务的日志。



### `requestCrashTime`

检测到崩溃的日期时间，采用 UTC 格式 - "2020-01-01T00:00:00+02:00"。可用于过滤服务的日志。



### `requestElapsedTimeInSeconds`

请求开始和崩溃时间之间经过的秒数。可与超时限制进行比较，以了解这可能是崩溃的原因。



## 参见

- [此函数的源代码](https://github.com/remotion-dev/remotion/blob/main/packages/cloudrun/src/api/render-media-on-cloudrun.ts)
